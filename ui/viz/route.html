<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  html { height: 100% }
  body { height: 100%; margin: 0px; padding: 0px }
  #map_canvas { height: 100% }
</style>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
<script type="text/javascript"
    src="http://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript">
  function initialize() {
  }

$(function() {
    var latlng = new google.maps.LatLng(39.9522222, -75.1641667);
    var myOptions = {
      zoom: 12,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    map = new google.maps.Map(document.getElementById("map_canvas"),
        myOptions);


    url = "http://localhost:8080/interval?route_id=1"

    function mk_color( mph ) {
	if (mph < 15) {
	    return "#FF" + Math.floor((mph/15.0)*255.0).toString(16) + "00";
	} else {
	    return "#" + Math.floor((mph/50.0)*255.0).toString(16) + "FF00";
	}
    }
	    

    $.ajax({
	dataType: 'jsonp',
	url: url,
	success: function( json ) {
	    var color1 = "#FF0000";
	    var color2 = "#0000FF";
	    var color = color1;
	    var w = 3;

	    $.map(json, function( pt ) {
		if (w == 3) {
		    alert(mk_color(pt.ival.v * 2.23693629));
		}

		if (color == color1) {
		    color = color2;
		    w = 4;
		} else {
		    color = color1;
		    w = 2;
		}

		var slat = pt.pts[0].lat
		var slon = pt.pts[0].lon

		new google.maps.Marker({
		    position: new google.maps.LatLng(slat,slon),
		    title: (pt.ival.v * 2.23693629) + " mph"
//		    map: map
		});

		var pts = $.map(pt.pts, function( ll ) {
		    return new google.maps.LatLng(ll.lat, ll.lon);
		});
		

		new google.maps.Polyline({
		    path: pts,
		    strokeColor: mk_color(pt.ival.v * 2.23693629),
		    strokeOpacity: '1.0',
		    strokeWeight: w,
		    map: map
		});
	    });
	}
    });
});
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width:100%; height:100%"></div>
</body>
</html>
